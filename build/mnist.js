/// <reference path="./all.ts" />
var fs_1 = require('fs');
var path_1 = require('path');
var dataPath = './digits';
var Digit = (function () {
    function Digit(pixels, value) {
        this.pixels = pixels;
        this.value = value;
    }
    return Digit;
})();
var MnistData = (function () {
    function MnistData(size) {
        if (size === void 0) { size = 20; }
        var trainings = [], testing, labels;
        for (var i = 0; i < size; i++) {
            trainings.push(fs_1.readFileSync(path_1.join(__dirname, dataPath, "training_" + i + ".json")));
        }
        testing = fs_1.readFileSync(path_1.join(__dirname, dataPath, "testing.json"));
        labels = fs_1.readFileSync(path_1.join(__dirname, dataPath, "mnist_labels.json"));
        this.mnistTraining = this.parseTraining(trainings, labels);
        this.mnistTesting = this.parseTesting(testing, labels);
    }
    MnistData.prototype.parseTraining = function (trainings, labels) {
        var digits = [];
        for (var i = 0; i < trainings.length; i++) {
            var set = trainings[i], index = i * 3000, cpt = 0, tmp = [];
            if (set.length % (3 * Math.pow(28, 2)) !== 0) {
                throw new Error("The length of the " + i + " portion should be a multiple " + 3 * Math.pow(28, 2));
            }
            for (var j = 0; j < set.length; j++) {
                index += Math.floor(j / 3);
                if (cpt === (3 * (Math.pow(28, 2) - 1))) {
                    digits.push(new Digit(tmp, labels[index]));
                    cpt = 0;
                    tmp.length = 0;
                }
                tmp.push(set[j]);
                cpt++;
            }
        }
        return digits;
    };
    MnistData.prototype.parseTesting = function (testing, labels) {
        var digits = [], set = testing, index = 20 * 3000, cpt = 0, tmp = [];
        if (set.length % (3 * Math.pow(28, 2)) !== 0) {
            throw new Error("The length of the testing portion should be a multiple " + 3 * Math.pow(28, 2));
        }
        for (var j = 0; j < set.length; j++) {
            index += Math.floor(j / 3);
            if (cpt === (3 * (Math.pow(28, 2) - 1))) {
                digits.push(new Digit(tmp, labels[index]));
                cpt = 0;
                tmp.length = 0;
            }
            tmp.push(set[j]);
            cpt++;
        }
        return digits;
    };
    return MnistData;
})();
exports.MnistData = MnistData;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1uaXN0LnRzIl0sIm5hbWVzIjpbIkRpZ2l0IiwiRGlnaXQuY29uc3RydWN0b3IiLCJNbmlzdERhdGEiLCJNbmlzdERhdGEuY29uc3RydWN0b3IiLCJNbmlzdERhdGEucGFyc2VUcmFpbmluZyIsIk1uaXN0RGF0YS5wYXJzZVRlc3RpbmciXSwibWFwcGluZ3MiOiJBQUFBLGlDQUFpQztBQUVqQyxtQkFBMkIsSUFBSSxDQUFDLENBQUE7QUFDaEMscUJBQW1CLE1BQU0sQ0FBQyxDQUFBO0FBRTFCLElBQU0sUUFBUSxHQUFHLFVBQVUsQ0FBQztBQUU1QjtJQUNFQSxlQUNTQSxNQUFnQkEsRUFDaEJBLEtBQWFBO1FBRGJDLFdBQU1BLEdBQU5BLE1BQU1BLENBQVVBO1FBQ2hCQSxVQUFLQSxHQUFMQSxLQUFLQSxDQUFRQTtJQUd0QkEsQ0FBQ0E7SUFDSEQsWUFBQ0E7QUFBREEsQ0FQQSxBQU9DQSxJQUFBO0FBRUQ7SUFJRUUsbUJBQ0VBLElBQWlCQTtRQUFqQkMsb0JBQWlCQSxHQUFqQkEsU0FBaUJBO1FBR2pCQSxJQUFJQSxTQUFTQSxHQUFHQSxFQUFFQSxFQUNkQSxPQUFPQSxFQUNQQSxNQUFNQSxDQUFDQTtRQUVYQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUMvQkEsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQVlBLENBQUNBLFdBQUlBLENBQUNBLFNBQVNBLEVBQUVBLFFBQVFBLEVBQUVBLGNBQVlBLENBQUNBLFVBQU9BLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2hGQSxDQUFDQTtRQUNEQSxPQUFPQSxHQUFHQSxpQkFBWUEsQ0FBQ0EsV0FBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsUUFBUUEsRUFBRUEsY0FBY0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbEVBLE1BQU1BLEdBQUdBLGlCQUFZQSxDQUFDQSxX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LENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQzdDQSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSw0REFBMERBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUdBLENBQUNBLENBQUNBO1FBQ25HQSxDQUFDQTtRQUNEQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUVwQ0EsS0FBS0EsSUFBSUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDM0JBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUN4Q0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsS0FBS0EsQ0FBQ0EsR0FBR0EsRUFBRUEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzNDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDUkEsR0FBR0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDakJBLENBQUNBO1lBQ0RBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ2pCQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUVSQSxDQUFDQTtRQUVEQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUVoQkEsQ0FBQ0E7SUFDSEgsZ0JBQUNBO0FBQURBLENBakZBLEFBaUZDQSxJQUFBO0FBakZZLGlCQUFTLFlBaUZyQixDQUFBIiwiZmlsZSI6Im1uaXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vYWxsLnRzXCIgLz5cblxuaW1wb3J0IHtyZWFkRmlsZVN5bmN9IGZyb20gJ2ZzJztcbmltcG9ydCB7am9pbn0gZnJvbSAncGF0aCc7XG5cbmNvbnN0IGRhdGFQYXRoID0gJy4vZGlnaXRzJztcblxuY2xhc3MgRGlnaXQge1xuICBjb25zdHJ1Y3RvciAoXG4gICAgcHVibGljIHBpeGVsczogbnVtYmVyW10sXG4gICAgcHVibGljIHZhbHVlOiBudW1iZXJcbiAgKSB7XG4gICAgXG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIE1uaXN0RGF0YSB7XG4gIHByaXZhdGUgbW5pc3RUcmFpbmluZzogRGlnaXRbXTtcbiAgcHJpdmF0ZSBtbmlzdFRlc3Rpbmc6IERpZ2l0W107XG4gIFxuICBjb25zdHJ1Y3RvcihcbiAgICBzaXplOiBudW1iZXIgPSAyMFxuICApIHtcbiAgICBcbiAgICBsZXQgdHJhaW5pbmdzID0gW10sXG4gICAgICAgIHRlc3RpbmcsXG4gICAgICAgIGxhYmVscztcbiAgICAgICAgXG4gICAgZm9yIChsZXQgaSA9IDAgOyBpIDwgc2l6ZTsgaSsrKSB7XG4gICAgICB0cmFpbmluZ3MucHVzaChyZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsIGRhdGFQYXRoLCBgdHJhaW5pbmdfJHtpfS5qc29uYCkpKTtcbiAgICB9XG4gICAgdGVzdGluZyA9IHJlYWRGaWxlU3luYyhqb2luKF9fZGlybmFtZSwgZGF0YVBhdGgsIGB0ZXN0aW5nLmpzb25gKSk7XG4gICAgbGFiZWxzID0gcmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCBkYXRhUGF0aCwgYG1uaXN0X2xhYmVscy5qc29uYCkpO1xuICAgIFxuICAgIHRoaXMubW5pc3RUcmFpbmluZyA9IHRoaXMucGFyc2VUcmFpbmluZyh0cmFpbmluZ3MsIGxhYmVscyk7XG4gICAgdGhpcy5tbmlzdFRlc3RpbmcgPSB0aGlzLnBhcnNlVGVzdGluZyh0ZXN0aW5nLCBsYWJlbHMpO1xuICB9XG4gIFxuICBwcml2YXRlIHBhcnNlVHJhaW5pbmcgKHRyYWluaW5nczogbnVtYmVyW11bXSwgbGFiZWxzOiBudW1iZXJbXSk6IERpZ2l0W10ge1xuICAgIFxuICAgIGxldCBkaWdpdHMgPSBbXTtcbiAgICBcbiAgICBmb3IgKGxldCBpID0gMCA7IGkgPCB0cmFpbmluZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIFxuICAgICAgbGV0IHNldCA9IHRyYWluaW5nc1tpXSxcbiAgICAgICAgICBpbmRleCA9IGkgKiAzMDAwLFxuICAgICAgICAgIGNwdCA9IDAsXG4gICAgICAgICAgdG1wID0gW107XG4gICAgICAgICAgXG4gICAgICBpZiAoc2V0Lmxlbmd0aCAlICgzICogTWF0aC5wb3coMjgsIDIpKSAhPT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBsZW5ndGggb2YgdGhlICR7aX0gcG9ydGlvbiBzaG91bGQgYmUgYSBtdWx0aXBsZSAkezMgKiBNYXRoLnBvdygyOCwgMil9YCk7XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNldC5sZW5ndGg7IGorKykge1xuICAgICAgICBcbiAgICAgICAgaW5kZXggKz0gTWF0aC5mbG9vcihqIC8gMyk7XG4gICAgICAgIGlmIChjcHQgPT09ICgzICogKE1hdGgucG93KDI4LCAyKSAtIDEpKSkge1xuICAgICAgICAgIGRpZ2l0cy5wdXNoKG5ldyBEaWdpdCh0bXAsIGxhYmVsc1tpbmRleF0pKTtcbiAgICAgICAgICBjcHQgPSAwO1xuICAgICAgICAgIHRtcC5sZW5ndGggPSAwO1xuICAgICAgICB9XG4gICAgICAgIHRtcC5wdXNoKHNldFtqXSk7XG4gICAgICAgIGNwdCsrO1xuICAgICAgICBcbiAgICAgIH1cbiAgICAgIFxuICAgIH1cbiAgICByZXR1cm4gZGlnaXRzO1xuICAgIFxuICB9XG4gIFxuICBwcml2YXRlIHBhcnNlVGVzdGluZyAodGVzdGluZzogbnVtYmVyW10sIGxhYmVsczogbnVtYmVyW10pOiBEaWdpdFtdIHtcbiAgICBcbiAgICBsZXQgZGlnaXRzID0gW10sXG4gICAgICAgIHNldCA9IHRlc3RpbmcsXG4gICAgICAgIGluZGV4ID0gMjAgKiAzMDAwLFxuICAgICAgICBjcHQgPSAwLFxuICAgICAgICB0bXAgPSBbXTtcbiAgICAgICAgXG4gICAgaWYgKHNldC5sZW5ndGggJSAoMyAqIE1hdGgucG93KDI4LCAyKSkgIT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGxlbmd0aCBvZiB0aGUgdGVzdGluZyBwb3J0aW9uIHNob3VsZCBiZSBhIG11bHRpcGxlICR7MyAqIE1hdGgucG93KDI4LCAyKX1gKTtcbiAgICB9XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBzZXQubGVuZ3RoOyBqKyspIHtcbiAgICAgIFxuICAgICAgaW5kZXggKz0gTWF0aC5mbG9vcihqIC8gMyk7XG4gICAgICBpZiAoY3B0ID09PSAoMyAqIChNYXRoLnBvdygyOCwgMikgLSAxKSkpIHtcbiAgICAgICAgZGlnaXRzLnB1c2gobmV3IERpZ2l0KHRtcCwgbGFiZWxzW2luZGV4XSkpO1xuICAgICAgICBjcHQgPSAwO1xuICAgICAgICB0bXAubGVuZ3RoID0gMDtcbiAgICAgIH1cbiAgICAgIHRtcC5wdXNoKHNldFtqXSk7XG4gICAgICBjcHQrKztcbiAgICAgIFxuICAgIH1cbiAgICAgIFxuICAgIHJldHVybiBkaWdpdHM7XG4gICAgXG4gIH1cbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=