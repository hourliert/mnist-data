/// <reference path="./all.ts" />
var fs_1 = require('fs');
var path_1 = require('path');
var dataPath = './digits', digitsPerFile = 3000, numberOfTrainings = 50000, imageWidth = 28, imageHeight = 28;
var Digit = (function () {
    function Digit(pixels, value) {
        this.pixels = pixels;
        this.value = value;
    }
    return Digit;
})();
exports.Digit = Digit;
var MnistData = (function () {
    function MnistData(numberOfTrainingToParse, numberOfTestingToParse) {
        if (numberOfTrainingToParse === void 0) { numberOfTrainingToParse = 20; }
        if (numberOfTestingToParse === void 0) { numberOfTestingToParse = 1; }
        this.numberOfTrainingToParse = numberOfTrainingToParse;
        this.numberOfTestingToParse = numberOfTestingToParse;
        var trainings = [], testing, labels;
        for (var i = 0; i < numberOfTrainingToParse; i++) {
            trainings.push(JSON.parse(fs_1.readFileSync(path_1.join(__dirname, dataPath, "training_" + i + ".json")).toString()));
        }
        testing = JSON.parse(fs_1.readFileSync(path_1.join(__dirname, dataPath, "testing.json")).toString());
        labels = JSON.parse(fs_1.readFileSync(path_1.join(__dirname, dataPath, "mnist_labels.json")).toString());
        this.mnistTraining = this.parseSets(trainings, labels);
        this.mnistTesting = this.parseOneSet(testing, labels);
        this.mnistValidating = this.mnistTraining.splice(numberOfTrainings);
    }
    MnistData.draw = function (digit, context, offsetX, offsetY) {
        var imageData = context.getImageData(offsetX || 0, offsetY || 0, imageWidth, imageHeight);
        for (var i = 0; i < digit.length; i++) {
            imageData.data[i * 4] = digit[i];
            imageData.data[i * 4 + 1] = digit[i];
            imageData.data[i * 4 + 2] = digit[i];
        }
        context.putImageData(imageData, offsetX || 0, offsetY || 0);
    };
    MnistData.prototype.getOneTraining = function () {
        var index = Math.floor(Math.random() * this.mnistTraining.length);
        return this.mnistTraining[index];
    };
    MnistData.prototype.getOneValidating = function () {
        var index = Math.floor(Math.random() * this.mnistValidating.length);
        return this.mnistTesting[index];
    };
    MnistData.prototype.getOneTesting = function () {
        var index = Math.floor(Math.random() * this.mnistTesting.length);
        return this.mnistTesting[index];
    };
    MnistData.prototype.parseSets = function (sets, labels) {
        var digits = [];
        for (var i = 0; i < sets.length; i++) {
            digits = digits.concat(this.parseOneSet(sets[i], labels, i));
        }
        return digits;
    };
    MnistData.prototype.parseOneSet = function (set, labels, setIndex) {
        if (setIndex === void 0) { setIndex = 20; }
        var tmp = [], digits = [];
        if (set.length % (Math.pow(28, 2)) !== 0) {
            throw new Error("The length of the testing portion should be a multiple " + 3 * Math.pow(28, 2));
        }
        for (var j = 0; j < set.length; j++) {
            if (tmp.length === (Math.pow(28, 2))) {
                var index = setIndex * 3000 + Math.floor(j / (Math.pow(28, 2) - 1));
                digits.push(new Digit(tmp, labels[index]));
                tmp = [];
            }
            tmp.push(set[j]);
        }
        if (tmp.length === (Math.pow(28, 2))) {
            var index = setIndex * 3000 + Math.floor(set.length / (Math.pow(28, 2) - 1));
            digits.push(new Digit(tmp, labels[index]));
            tmp = [];
        }
        return digits;
    };
    return MnistData;
})();
exports.MnistData = MnistData;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1uaXN0LnRzIl0sIm5hbWVzIjpbIkRpZ2l0IiwiRGlnaXQuY29uc3RydWN0b3IiLCJNbmlzdERhdGEiLCJNbmlzdERhdGEuY29uc3RydWN0b3IiLCJNbmlzdERhdGEuZHJhdyIsIk1uaXN0RGF0YS5nZXRPbmVUcmFpbmluZyIsIk1uaXN0RGF0YS5nZXRPbmVWYWxpZGF0aW5nIiwiTW5pc3REYXRhLmdldE9uZVRlc3RpbmciLCJNbmlzdERhdGEucGFyc2VTZXRzIiwiTW5pc3REYXRhLnBhcnNlT25lU2V0Il0sIm1hcHBpbmdzIjoiQUFBQSxpQ0FBaUM7QUFFakMsbUJBQTJCLElBQUksQ0FBQyxDQUFBO0FBQ2hDLHFCQUFtQixNQUFNLENBQUMsQ0FBQTtBQUUxQixJQUFNLFFBQVEsR0FBRyxVQUFVLEVBQ3JCLGFBQWEsR0FBRyxJQUFJLEVBQ3BCLGlCQUFpQixHQUFHLEtBQUssRUFDekIsVUFBVSxHQUFHLEVBQUUsRUFDZixXQUFXLEdBQUcsRUFBRSxDQUFDO0FBRXZCO0lBQ0VBLGVBQ1NBLE1BQWdCQSxFQUNoQkEsS0FBYUE7UUFEYkMsV0FBTUEsR0FBTkEsTUFBTUEsQ0FBVUE7UUFDaEJBLFVBQUtBLEdBQUxBLEtBQUtBLENBQVFBO0lBR3RCQSxDQUFDQTtJQUNIRCxZQUFDQTtBQUFEQSxDQVBBLEFBT0NBLElBQUE7QUFQWSxhQUFLLFFBT2pCLENBQUE7QUFFRDtJQUtFRSxtQkFDVUEsdUJBQW9DQSxFQUNwQ0Esc0JBQWtDQTtRQUQxQ0MsdUNBQTRDQSxHQUE1Q0EsNEJBQTRDQTtRQUM1Q0Esc0NBQTBDQSxHQUExQ0EsMEJBQTBDQTtRQURsQ0EsNEJBQXVCQSxHQUF2QkEsdUJBQXVCQSxDQUFhQTtRQUNwQ0EsMkJBQXNCQSxHQUF0QkEsc0JBQXNCQSxDQUFZQTtRQUcxQ0EsSUFBSUEsU0FBU0EsR0FBR0EsRUFBRUEsRUFDZEEsT0FBT0EsRUFDUEEsTUFBTUEsQ0FBQ0E7UUFFWEEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0Es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QUdBLEVBQUVBLENBQUNBO1FBRWhCQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN6Q0EsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0EsNERBQTBEQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFHQSxDQUFDQSxDQUFDQTtRQUNuR0EsQ0FBQ0E7UUFDREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFFcENBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUNyQ0EsSUFBSUEsS0FBS0EsR0FBR0EsUUFBUUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3BFQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDM0NBLEdBQUdBLEdBQUdBLEVBQUVBLENBQUNBO1lBQ1hBLENBQUNBO1lBQ0RBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRW5CQSxDQUFDQTtRQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyQ0EsSUFBSUEsS0FBS0EsR0FBR0EsUUFBUUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDN0VBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQzNDQSxHQUFHQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNYQSxDQUFDQTtRQUNEQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUVoQkEsQ0FBQ0E7SUFDSFAsZ0JBQUNBO0FBQURBLENBdkZBLEFBdUZDQSxJQUFBO0FBdkZZLGlCQUFTLFlBdUZyQixDQUFBIiwiZmlsZSI6Im1uaXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vYWxsLnRzXCIgLz5cblxuaW1wb3J0IHtyZWFkRmlsZVN5bmN9IGZyb20gJ2ZzJztcbmltcG9ydCB7am9pbn0gZnJvbSAncGF0aCc7XG5cbmNvbnN0IGRhdGFQYXRoID0gJy4vZGlnaXRzJyxcbiAgICAgIGRpZ2l0c1BlckZpbGUgPSAzMDAwLFxuICAgICAgbnVtYmVyT2ZUcmFpbmluZ3MgPSA1MDAwMCxcbiAgICAgIGltYWdlV2lkdGggPSAyOCxcbiAgICAgIGltYWdlSGVpZ2h0ID0gMjg7XG5cbmV4cG9ydCBjbGFzcyBEaWdpdCB7XG4gIGNvbnN0cnVjdG9yIChcbiAgICBwdWJsaWMgcGl4ZWxzOiBudW1iZXJbXSxcbiAgICBwdWJsaWMgdmFsdWU6IG51bWJlclxuICApIHtcbiAgICBcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTW5pc3REYXRhIHtcbiAgcHJpdmF0ZSBtbmlzdFRyYWluaW5nOiBEaWdpdFtdO1xuICBwcml2YXRlIG1uaXN0VmFsaWRhdGluZzogRGlnaXRbXTtcbiAgcHJpdmF0ZSBtbmlzdFRlc3Rpbmc6IERpZ2l0W107XG4gIFxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIG51bWJlck9mVHJhaW5pbmdUb1BhcnNlOiBudW1iZXIgPSAyMCxcbiAgICBwcml2YXRlIG51bWJlck9mVGVzdGluZ1RvUGFyc2U6IG51bWJlciA9IDFcbiAgKSB7XG4gICAgXG4gICAgbGV0IHRyYWluaW5ncyA9IFtdLFxuICAgICAgICB0ZXN0aW5nLFxuICAgICAgICBsYWJlbHM7XG4gICAgICAgIFxuICAgIGZvciAobGV0IGkgPSAwIDsgaSA8IG51bWJlck9mVHJhaW5pbmdUb1BhcnNlOyBpKyspIHtcbiAgICAgIHRyYWluaW5ncy5wdXNoKEpTT04ucGFyc2UocmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCBkYXRhUGF0aCwgYHRyYWluaW5nXyR7aX0uanNvbmApKS50b1N0cmluZygpKSk7XG4gICAgfVxuICAgIHRlc3RpbmcgPSBKU09OLnBhcnNlKHJlYWRGaWxlU3luYyhqb2luKF9fZGlybmFtZSwgZGF0YVBhdGgsIGB0ZXN0aW5nLmpzb25gKSkudG9TdHJpbmcoKSk7XG4gICAgbGFiZWxzID0gSlNPTi5wYXJzZShyZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsIGRhdGFQYXRoLCBgbW5pc3RfbGFiZWxzLmpzb25gKSkudG9TdHJpbmcoKSk7XG4gICAgXG4gICAgdGhpcy5tbmlzdFRyYWluaW5nID0gdGhpcy5wYXJzZVNldHModHJhaW5pbmdzLCBsYWJlbHMpO1xuICAgIHRoaXMubW5pc3RUZXN0aW5nID0gdGhpcy5wYXJzZU9uZVNldCh0ZXN0aW5nLCBsYWJlbHMpO1xuICAgIHRoaXMubW5pc3RWYWxpZGF0aW5nID0gdGhpcy5tbmlzdFRyYWluaW5nLnNwbGljZShudW1iZXJPZlRyYWluaW5ncyk7XG4gIH1cbiAgXG4gIHN0YXRpYyBkcmF3IChkaWdpdDogbnVtYmVyW10sIGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgb2Zmc2V0WDogbnVtYmVyLCBvZmZzZXRZOiBudW1iZXIpIHtcbiAgICBcbiAgICB2YXIgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEob2Zmc2V0WCB8fCAwLCBvZmZzZXRZIHx8IDAsIGltYWdlV2lkdGgsIGltYWdlSGVpZ2h0KTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRpZ2l0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBpbWFnZURhdGEuZGF0YVtpICogNF0gPSBkaWdpdFtpXTtcbiAgICAgIGltYWdlRGF0YS5kYXRhW2kgKiA0ICsgMV0gPSBkaWdpdFtpXTtcbiAgICAgIGltYWdlRGF0YS5kYXRhW2kgKiA0ICsgMl0gPSBkaWdpdFtpXTtcbiAgICB9XG4gICAgY29udGV4dC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCBvZmZzZXRYIHx8IDAsIG9mZnNldFkgfHwgMCk7XG4gICAgXG4gIH1cbiAgXG4gIHB1YmxpYyBnZXRPbmVUcmFpbmluZyAoKTogRGlnaXQge1xuICAgIGxldCBpbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMubW5pc3RUcmFpbmluZy5sZW5ndGgpO1xuICAgIHJldHVybiB0aGlzLm1uaXN0VHJhaW5pbmdbaW5kZXhdO1xuICB9XG4gIFxuICBwdWJsaWMgZ2V0T25lVmFsaWRhdGluZyAoKTogRGlnaXQge1xuICAgIGxldCBpbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMubW5pc3RWYWxpZGF0aW5nLmxlbmd0aCk7XG4gICAgcmV0dXJuIHRoaXMubW5pc3RUZXN0aW5nW2luZGV4XTtcbiAgfVxuICBcbiAgcHVibGljIGdldE9uZVRlc3RpbmcgKCk6IERpZ2l0IHtcbiAgICBsZXQgaW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLm1uaXN0VGVzdGluZy5sZW5ndGgpO1xuICAgIHJldHVybiB0aGlzLm1uaXN0VGVzdGluZ1tpbmRleF07XG4gIH1cbiAgXG4gIHByaXZhdGUgcGFyc2VTZXRzIChzZXRzOiBudW1iZXJbXVtdLCBsYWJlbHM6IG51bWJlcltdKTogRGlnaXRbXSB7XG4gICAgbGV0IGRpZ2l0cyA9IFtdO1xuICAgIFxuICAgIGZvciAobGV0IGkgPSAwIDsgaSA8IHNldHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGRpZ2l0cyA9IGRpZ2l0cy5jb25jYXQodGhpcy5wYXJzZU9uZVNldChzZXRzW2ldLCBsYWJlbHMsIGkpKTtcbiAgICB9XG4gICAgcmV0dXJuIGRpZ2l0cztcbiAgICBcbiAgfVxuICBcbiAgcHJpdmF0ZSBwYXJzZU9uZVNldCAoc2V0OiBudW1iZXJbXSwgbGFiZWxzOiBudW1iZXJbXSwgc2V0SW5kZXg6IG51bWJlciA9IDIwKTogRGlnaXRbXSB7XG4gICAgbGV0IHRtcCA9IFtdLFxuICAgICAgICBkaWdpdHMgPSBbXTtcbiAgICBcbiAgICBpZiAoc2V0Lmxlbmd0aCAlIChNYXRoLnBvdygyOCwgMikpICE9PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBsZW5ndGggb2YgdGhlIHRlc3RpbmcgcG9ydGlvbiBzaG91bGQgYmUgYSBtdWx0aXBsZSAkezMgKiBNYXRoLnBvdygyOCwgMil9YCk7XG4gICAgfVxuICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2V0Lmxlbmd0aDsgaisrKSB7XG4gICAgICAgIFxuICAgICAgaWYgKHRtcC5sZW5ndGggPT09IChNYXRoLnBvdygyOCwgMikpKSB7XG4gICAgICAgIGxldCBpbmRleCA9IHNldEluZGV4ICogMzAwMCArIE1hdGguZmxvb3IoaiAvIChNYXRoLnBvdygyOCwgMikgLSAxKSk7XG4gICAgICAgIGRpZ2l0cy5wdXNoKG5ldyBEaWdpdCh0bXAsIGxhYmVsc1tpbmRleF0pKTtcbiAgICAgICAgdG1wID0gW107XG4gICAgICB9XG4gICAgICB0bXAucHVzaChzZXRbal0pO1xuICAgICAgXG4gICAgfVxuICAgIGlmICh0bXAubGVuZ3RoID09PSAoTWF0aC5wb3coMjgsIDIpKSkge1xuICAgICAgbGV0IGluZGV4ID0gc2V0SW5kZXggKiAzMDAwICsgTWF0aC5mbG9vcihzZXQubGVuZ3RoIC8gKE1hdGgucG93KDI4LCAyKSAtIDEpKTtcbiAgICAgIGRpZ2l0cy5wdXNoKG5ldyBEaWdpdCh0bXAsIGxhYmVsc1tpbmRleF0pKTtcbiAgICAgIHRtcCA9IFtdO1xuICAgIH1cbiAgICByZXR1cm4gZGlnaXRzO1xuICAgIFxuICB9XG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9