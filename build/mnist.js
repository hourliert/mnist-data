/// <reference path="./all.ts" />
var fs_1 = require('fs');
var path_1 = require('path');
var dataPath = './digits';
var Digit = (function () {
    function Digit(pixels, value) {
        this.pixels = pixels;
        this.value = value;
    }
    return Digit;
})();
var MnistData = (function () {
    function MnistData(size) {
        if (size === void 0) { size = 20; }
        var trainings = [], testing, labels;
        for (var i = 0; i < size; i++) {
            trainings.push(JSON.parse(fs_1.readFileSync(path_1.join(__dirname, dataPath, "training_" + i + ".json")).toString()));
        }
        testing = JSON.parse(fs_1.readFileSync(path_1.join(__dirname, dataPath, "testing.json")).toString());
        labels = JSON.parse(fs_1.readFileSync(path_1.join(__dirname, dataPath, "mnist_labels.json")).toString());
        this.mnistTraining = this.parseTraining(trainings, labels);
        this.mnistTesting = this.parseTesting(testing, labels);
    }
    MnistData.prototype.parseTraining = function (trainings, labels) {
        var digits = [];
        for (var i = 0; i < trainings.length; i++) {
            var set = trainings[i], cpt = 0, tmp = [];
            if (set.length % (3 * Math.pow(28, 2)) !== 0) {
                throw new Error("The length of the " + i + " portion should be a multiple " + 3 * Math.pow(28, 2));
            }
            for (var j = 0; j < set.length; j += 3) {
                if (cpt === (Math.pow(28, 2))) {
                    var index = i * 3000 + Math.floor(j / (3 * Math.pow(28, 2)));
                    digits.push(new Digit(tmp, labels[index]));
                    cpt = 0;
                    tmp.length = 0;
                }
                tmp.push(set[j], set[j + 1], set[j + 2]);
                cpt++;
            }
        }
        return digits;
    };
    MnistData.prototype.parseTesting = function (testing, labels) {
        var digits = [], set = testing, cpt = 0, tmp = [];
        if (set.length % (3 * Math.pow(28, 2)) !== 0) {
            throw new Error("The length of the testing portion should be a multiple " + 3 * Math.pow(28, 2));
        }
        for (var j = 0; j < set.length; j += 3) {
            if (cpt === (Math.pow(28, 2))) {
                var index = 20 * 3000 + Math.floor(j / (3 * Math.pow(28, 2)));
                digits.push(new Digit(tmp, labels[index]));
                cpt = 0;
                tmp.length = 0;
            }
            tmp.push(set[j], set[j + 1], set[j + 2]);
            cpt++;
        }
        return digits;
    };
    return MnistData;
})();
exports.MnistData = MnistData;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1uaXN0LnRzIl0sIm5hbWVzIjpbIkRpZ2l0IiwiRGlnaXQuY29uc3RydWN0b3IiLCJNbmlzdERhdGEiLCJNbmlzdERhdGEuY29uc3RydWN0b3IiLCJNbmlzdERhdGEucGFyc2VUcmFpbmluZyIsIk1uaXN0RGF0YS5wYXJzZVRlc3RpbmciXSwibWFwcGluZ3MiOiJBQUFBLGlDQUFpQztBQUVqQyxtQkFBMkIsSUFBSSxDQUFDLENBQUE7QUFDaEMscUJBQW1CLE1BQU0sQ0FBQyxDQUFBO0FBRTFCLElBQU0sUUFBUSxHQUFHLFVBQVUsQ0FBQztBQUU1QjtJQUNFQSxlQUNTQSxNQUFnQkEsRUFDaEJBLEtBQWFBO1FBRGJDLFdBQU1BLEdBQU5BLE1BQU1BLENBQVVBO1FBQ2hCQSxVQUFLQSxHQUFMQSxLQUFLQSxDQUFRQTtJQUd0QkEsQ0FBQ0E7SUFDSEQsWUFBQ0E7QUFBREEsQ0FQQSxBQU9DQSxJQUFBO0FBRUQ7SUFJRUUsbUJBQ0VBLElBQWlCQTtRQUFqQkMsb0JBQWlCQSxHQUFqQkEsU0FBaUJBO1FBR2pCQSxJQUFJQSxTQUFTQSxHQUFHQSxFQUFFQSxFQUNkQSxPQUFPQSxFQUNQQSxNQUFNQSxDQUFDQTtRQUVYQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUMvQkEsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsaUJBQVlBLENBQUNBLFdBQUlBLENBQUNBLFNBQVNBLEVBQUVBLFFBQVFBLEVBQUVBLGNBQVlBLENBQUNBLFVBQU9BLENBQUNBLENBQUNBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ3ZHQSxDQUFDQTtRQUNEQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxpQkFBWUEsQ0FBQ0EsV0FBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsUUFBUUEsRUFBRUEsY0FBY0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDekZBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLGlCQUFZQSxDQUFDQSxXQUFJQSxDQUFDQSxTQUFTQSxFQUFFQSxRQUFRQSxFQUFFQSxtQkFBbUJBLENBQUNBLENBQUNBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBLENBQUNBO1FBRTdGQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxTQUFTQSxFQUFFQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUMzREEsSUFBSUEsQ0FBQ0EsWUFBWUEsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsT0FBT0EsRUFBRUEsTUFBTUEsQ0FBQ0EsQ0FBQ0E7SUFDekRBLENBQUNBO0lBRU9ELGlDQUFhQSxHQUFyQkEsVUFBdUJBLFNBQXFCQSxFQUFFQSxNQUFnQkE7UUFFNURFLElBQUlBLE1BQU1BLEdBQUdBLEVBQUVBLENBQUNBO1FBRWhCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFHQSxDQUFDQSxHQUFHQSxTQUFTQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUUzQ0EsSUFBSUEsR0FBR0EsR0FBR0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFDbEJBLEdBQUdBLEdBQUdBLENBQUNBLEVBQ1BBLEdBQUdBLEdBQUdBLEVBQUVBLENBQUNBO1lBRWJBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUM3Q0EsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0EsdUJBQXFCQSxDQUFDQSxzQ0FBaUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUdBLENBQUNBLENBQUNBO1lBQ2hHQSxDQUFDQTtZQUNEQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQTtnQkFFdkNBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO29CQUM5QkEsSUFBSUEsS0FBS0EsR0FBR0EsQ0FBQ0EsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQzdEQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDM0NBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBO29CQUNSQSxHQUFHQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDakJBLENBQUNBO2dCQUNEQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDckNBLEdBQUdBLEVBQUVBLENBQUNBO1lBRVJBLENBQUNBO1FBRUhBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO0lBRWhCQSxDQUFDQTtJQUVPRixnQ0FBWUEsR0FBcEJBLFVBQXNCQSxPQUFpQkEsRUFBRUEsTUFBZ0JBO1FBRXZERyxJQUFJQSxNQUFNQSxHQUFHQSxFQUFFQSxFQUNYQSxHQUFHQSxHQUFHQSxPQUFPQSxFQUNiQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUNQQSxHQUFHQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUViQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3Q0EsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0EsNERBQTBEQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFHQSxDQUFDQSxDQUFDQTtRQUNuR0EsQ0FBQ0E7UUFDREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7WUFFdkNBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUM5QkEsSUFBSUEsS0FBS0EsR0FBR0EsRUFBRUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzlEQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDM0NBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBO2dCQUNSQSxHQUFHQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNqQkEsQ0FBQ0E7WUFDREEsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDckNBLEdBQUdBLEVBQUVBLENBQUNBO1FBRVJBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO0lBRWhCQSxDQUFDQTtJQUNISCxnQkFBQ0E7QUFBREEsQ0E5RUEsQUE4RUNBLElBQUE7QUE5RVksaUJBQVMsWUE4RXJCLENBQUEiLCJmaWxlIjoibW5pc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi9hbGwudHNcIiAvPlxuXG5pbXBvcnQge3JlYWRGaWxlU3luY30gZnJvbSAnZnMnO1xuaW1wb3J0IHtqb2lufSBmcm9tICdwYXRoJztcblxuY29uc3QgZGF0YVBhdGggPSAnLi9kaWdpdHMnO1xuXG5jbGFzcyBEaWdpdCB7XG4gIGNvbnN0cnVjdG9yIChcbiAgICBwdWJsaWMgcGl4ZWxzOiBudW1iZXJbXSxcbiAgICBwdWJsaWMgdmFsdWU6IG51bWJlclxuICApIHtcbiAgICBcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTW5pc3REYXRhIHtcbiAgcHJpdmF0ZSBtbmlzdFRyYWluaW5nOiBEaWdpdFtdO1xuICBwcml2YXRlIG1uaXN0VGVzdGluZzogRGlnaXRbXTtcbiAgXG4gIGNvbnN0cnVjdG9yKFxuICAgIHNpemU6IG51bWJlciA9IDIwXG4gICkge1xuICAgIFxuICAgIGxldCB0cmFpbmluZ3MgPSBbXSxcbiAgICAgICAgdGVzdGluZyxcbiAgICAgICAgbGFiZWxzO1xuICAgICAgICBcbiAgICBmb3IgKGxldCBpID0gMCA7IGkgPCBzaXplOyBpKyspIHtcbiAgICAgIHRyYWluaW5ncy5wdXNoKEpTT04ucGFyc2UocmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCBkYXRhUGF0aCwgYHRyYWluaW5nXyR7aX0uanNvbmApKS50b1N0cmluZygpKSk7XG4gICAgfVxuICAgIHRlc3RpbmcgPSBKU09OLnBhcnNlKHJlYWRGaWxlU3luYyhqb2luKF9fZGlybmFtZSwgZGF0YVBhdGgsIGB0ZXN0aW5nLmpzb25gKSkudG9TdHJpbmcoKSk7XG4gICAgbGFiZWxzID0gSlNPTi5wYXJzZShyZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsIGRhdGFQYXRoLCBgbW5pc3RfbGFiZWxzLmpzb25gKSkudG9TdHJpbmcoKSk7XG4gICAgXG4gICAgdGhpcy5tbmlzdFRyYWluaW5nID0gdGhpcy5wYXJzZVRyYWluaW5nKHRyYWluaW5ncywgbGFiZWxzKTtcbiAgICB0aGlzLm1uaXN0VGVzdGluZyA9IHRoaXMucGFyc2VUZXN0aW5nKHRlc3RpbmcsIGxhYmVscyk7XG4gIH1cbiAgXG4gIHByaXZhdGUgcGFyc2VUcmFpbmluZyAodHJhaW5pbmdzOiBudW1iZXJbXVtdLCBsYWJlbHM6IG51bWJlcltdKTogRGlnaXRbXSB7XG4gICAgXG4gICAgbGV0IGRpZ2l0cyA9IFtdO1xuICAgIFxuICAgIGZvciAobGV0IGkgPSAwIDsgaSA8IHRyYWluaW5ncy5sZW5ndGg7IGkrKykge1xuICAgICAgXG4gICAgICBsZXQgc2V0ID0gdHJhaW5pbmdzW2ldLFxuICAgICAgICAgIGNwdCA9IDAsXG4gICAgICAgICAgdG1wID0gW107XG4gICAgICAgICAgXG4gICAgICBpZiAoc2V0Lmxlbmd0aCAlICgzICogTWF0aC5wb3coMjgsIDIpKSAhPT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBsZW5ndGggb2YgdGhlICR7aX0gcG9ydGlvbiBzaG91bGQgYmUgYSBtdWx0aXBsZSAkezMgKiBNYXRoLnBvdygyOCwgMil9YCk7XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNldC5sZW5ndGg7IGogKz0gMykge1xuICAgICAgICBcbiAgICAgICAgaWYgKGNwdCA9PT0gKE1hdGgucG93KDI4LCAyKSkpIHtcbiAgICAgICAgICBsZXQgaW5kZXggPSBpICogMzAwMCArIE1hdGguZmxvb3IoaiAvICgzICogTWF0aC5wb3coMjgsIDIpKSk7XG4gICAgICAgICAgZGlnaXRzLnB1c2gobmV3IERpZ2l0KHRtcCwgbGFiZWxzW2luZGV4XSkpO1xuICAgICAgICAgIGNwdCA9IDA7XG4gICAgICAgICAgdG1wLmxlbmd0aCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgdG1wLnB1c2goc2V0W2pdLCBzZXRbaisxXSwgc2V0W2orMl0pO1xuICAgICAgICBjcHQrKztcbiAgICAgICAgXG4gICAgICB9XG4gICAgICBcbiAgICB9XG4gICAgcmV0dXJuIGRpZ2l0cztcbiAgICBcbiAgfVxuICBcbiAgcHJpdmF0ZSBwYXJzZVRlc3RpbmcgKHRlc3Rpbmc6IG51bWJlcltdLCBsYWJlbHM6IG51bWJlcltdKTogRGlnaXRbXSB7XG4gICAgXG4gICAgbGV0IGRpZ2l0cyA9IFtdLFxuICAgICAgICBzZXQgPSB0ZXN0aW5nLFxuICAgICAgICBjcHQgPSAwLFxuICAgICAgICB0bXAgPSBbXTtcbiAgICAgICAgXG4gICAgaWYgKHNldC5sZW5ndGggJSAoMyAqIE1hdGgucG93KDI4LCAyKSkgIT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGxlbmd0aCBvZiB0aGUgdGVzdGluZyBwb3J0aW9uIHNob3VsZCBiZSBhIG11bHRpcGxlICR7MyAqIE1hdGgucG93KDI4LCAyKX1gKTtcbiAgICB9XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBzZXQubGVuZ3RoOyBqICs9IDMpIHtcbiAgICAgICAgXG4gICAgICBpZiAoY3B0ID09PSAoTWF0aC5wb3coMjgsIDIpKSkge1xuICAgICAgICBsZXQgaW5kZXggPSAyMCAqIDMwMDAgKyBNYXRoLmZsb29yKGogLyAoMyAqIE1hdGgucG93KDI4LCAyKSkpO1xuICAgICAgICBkaWdpdHMucHVzaChuZXcgRGlnaXQodG1wLCBsYWJlbHNbaW5kZXhdKSk7XG4gICAgICAgIGNwdCA9IDA7XG4gICAgICAgIHRtcC5sZW5ndGggPSAwO1xuICAgICAgfVxuICAgICAgdG1wLnB1c2goc2V0W2pdLCBzZXRbaisxXSwgc2V0W2orMl0pO1xuICAgICAgY3B0Kys7XG4gICAgICBcbiAgICB9XG4gICAgcmV0dXJuIGRpZ2l0cztcbiAgICBcbiAgfVxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==