/// <reference path="./all.ts" />
var fs_1 = require('fs');
var path_1 = require('path');
var dataPath = './digits', digitsPerFile = 3000, numberOfTrainings = 50000;
var Digit = (function () {
    function Digit(pixels, value) {
        this.pixels = pixels;
        this.value = value;
    }
    return Digit;
})();
exports.Digit = Digit;
var MnistData = (function () {
    function MnistData(numberOfTrainingToParse, numberOfTestingToParse) {
        if (numberOfTrainingToParse === void 0) { numberOfTrainingToParse = 20; }
        if (numberOfTestingToParse === void 0) { numberOfTestingToParse = 1; }
        this.numberOfTrainingToParse = numberOfTrainingToParse;
        this.numberOfTestingToParse = numberOfTestingToParse;
        var trainings = [], testing, labels;
        for (var i = 0; i < numberOfTrainingToParse; i++) {
            trainings.push(JSON.parse(fs_1.readFileSync(path_1.join(__dirname, dataPath, "training_" + i + ".json")).toString()));
        }
        testing = JSON.parse(fs_1.readFileSync(path_1.join(__dirname, dataPath, "testing.json")).toString());
        labels = JSON.parse(fs_1.readFileSync(path_1.join(__dirname, dataPath, "mnist_labels.json")).toString());
        this.mnistTraining = this.parseSets(trainings, labels);
        this.mnistTesting = this.parseOneSet(testing, labels);
        this.mnistValidating = this.mnistTraining.splice(numberOfTrainings);
    }
    MnistData.prototype.getOneTraining = function () {
        var index = Math.floor(Math.random() * this.mnistTraining.length);
        return this.mnistTraining[index];
    };
    MnistData.prototype.getOneValidating = function () {
        var index = Math.floor(Math.random() * this.mnistValidating.length);
        return this.mnistTesting[index];
    };
    MnistData.prototype.getOneTesting = function () {
        var index = Math.floor(Math.random() * this.mnistTesting.length);
        return this.mnistTesting[index];
    };
    MnistData.prototype.parseSets = function (sets, labels) {
        var digits = [];
        for (var i = 0; i < sets.length; i++) {
            digits = digits.concat(this.parseOneSet(sets[i], labels, i));
        }
        return digits;
    };
    MnistData.prototype.parseOneSet = function (set, labels, setIndex) {
        if (setIndex === void 0) { setIndex = 20; }
        var tmp = [], digits = [];
        if (set.length % (Math.pow(28, 2)) !== 0) {
            throw new Error("The length of the testing portion should be a multiple " + 3 * Math.pow(28, 2));
        }
        for (var j = 0; j < set.length; j++) {
            if (tmp.length === (Math.pow(28, 2))) {
                var index = setIndex * 3000 + Math.floor(j / (Math.pow(28, 2) - 1));
                digits.push(new Digit(tmp, labels[index]));
                tmp = [];
            }
            tmp.push(set[j]);
        }
        if (tmp.length === (Math.pow(28, 2))) {
            var index = setIndex * 3000 + Math.floor(set.length / (Math.pow(28, 2) - 1));
            digits.push(new Digit(tmp, labels[index]));
            tmp = [];
        }
        return digits;
    };
    return MnistData;
})();
exports.MnistData = MnistData;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1uaXN0LnRzIl0sIm5hbWVzIjpbIkRpZ2l0IiwiRGlnaXQuY29uc3RydWN0b3IiLCJNbmlzdERhdGEiLCJNbmlzdERhdGEuY29uc3RydWN0b3IiLCJNbmlzdERhdGEuZ2V0T25lVHJhaW5pbmciLCJNbmlzdERhdGEuZ2V0T25lVmFsaWRhdGluZyIsIk1uaXN0RGF0YS5nZXRPbmVUZXN0aW5nIiwiTW5pc3REYXRhLnBhcnNlU2V0cyIsIk1uaXN0RGF0YS5wYXJzZU9uZVNldCJdLCJtYXBwaW5ncyI6IkFBQUEsaUNBQWlDO0FBRWpDLG1CQUEyQixJQUFJLENBQUMsQ0FBQTtBQUNoQyxxQkFBbUIsTUFBTSxDQUFDLENBQUE7QUFFMUIsSUFBTSxRQUFRLEdBQUcsVUFBVSxFQUNyQixhQUFhLEdBQUcsSUFBSSxFQUNwQixpQkFBaUIsR0FBRyxLQUFLLENBQUM7QUFFaEM7SUFDRUEsZUFDU0EsTUFBZ0JBLEVBQ2hCQSxLQUFhQTtRQURiQyxXQUFNQSxHQUFOQSxNQUFNQSxDQUFVQTtRQUNoQkEsVUFBS0EsR0FBTEEsS0FBS0EsQ0FBUUE7SUFHdEJBLENBQUNBO0lBQ0hELFlBQUNBO0FBQURBLENBUEEsQUFPQ0EsSUFBQTtBQVBZLGFBQUssUUFPakIsQ0FBQTtBQUVEO0lBS0VFLG1CQUNVQSx1QkFBb0NBLEVBQ3BDQSxzQkFBa0NBO1FBRDFDQyx1Q0FBNENBLEdBQTVDQSw0QkFBNENBO1FBQzVDQSxzQ0FBMENBLEdBQTFDQSwwQkFBMENBO1FBRGxDQSw0QkFBdUJBLEdBQXZCQSx1QkFBdUJBLENBQWFBO1FBQ3BDQSwyQkFBc0JBLEdBQXRCQSxzQkFBc0JBLENBQVlBO1FBRzFDQSxJQUFJQSxTQUFTQSxHQUFHQSxFQUFFQSxFQUNkQSxPQUFPQSxFQUNQQSxNQUFNQSxDQUFDQTtRQUVYQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFHQSxDQUFDQSxHQUFHQSx1QkFBdUJBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ2xEQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxpQkFBWUEsQ0FBQ0EsV0FBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsUUFBUUEsRUFBRUEsY0FBWUEsQ0FBQ0EsVUFBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdkdBLENBQUNBO1FBQ0RBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLGlCQUFZQSxDQUFDQSxXQUFJQSxDQUFDQSxTQUFTQSxFQUFFQSxRQUFRQSxFQUFFQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUN6RkEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsaUJBQVlBLENBQUNBLFdBQUlBLENBQUNBLFNBQVNBLEVBQUVBLFFBQVFBLEVBQUVBLG1CQUFtQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFFN0ZBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLFNBQVNBLEVBQUVBLE1BQU1BLENBQUNBLENBQUNBO1FBQ3ZEQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxPQUFPQSxFQUFFQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUN0REEsSUFBSUEsQ0FBQ0EsZUFBZUEsR0FBR0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQTtJQUN0RUEsQ0FBQ0E7SUFFTUQsa0NBQWNBLEdBQXJCQTtRQUNFRSxJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUNsRUEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7SUFDbkNBLENBQUNBO0lBRU1GLG9DQUFnQkEsR0FBdkJBO1FBQ0VHLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ3BFQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtJQUNsQ0EsQ0FBQ0E7SUFFTUgsaUNBQWFBLEdBQXBCQTtRQUNFSSxJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUNqRUEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7SUFDbENBLENBQUNBO0lBRU9KLDZCQUFTQSxHQUFqQkEsVUFBbUJBLElBQWdCQSxFQUFFQSxNQUFnQkE7UUFDbkRLLElBQUlBLE1BQU1BLEdBQUdBLEVBQUVBLENBQUNBO1FBRWhCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUN0Q0EsTUFBTUEsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsTUFBTUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDL0RBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO0lBRWhCQSxDQUFDQTtJQUVPTCwrQkFBV0EsR0FBbkJBLFVBQXFCQSxHQUFhQSxFQUFFQSxNQUFnQkEsRUFBRUEsUUFBcUJBO1FBQXJCTSx3QkFBcUJBLEdBQXJCQSxhQUFxQkE7UUFDekVBLElBQUlBLEdBQUdBLEdBQUdBLEVBQUVBLEVBQ1JBLE1BQU1BLEdBQUdBLEVBQUVBLENBQUNBO1FBRWhCQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN6Q0EsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0EsNERBQTBEQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFHQSxDQUFDQSxDQUFDQTtRQUNuR0EsQ0FBQ0E7UUFDREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFFcENBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUNyQ0EsSUFBSUEsS0FBS0EsR0FBR0EsUUFBUUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3BFQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxLQUFLQSxDQUFDQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDM0NBLEdBQUdBLEdBQUdBLEVBQUVBLENBQUNBO1lBQ1hBLENBQUNBO1lBQ0RBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRW5CQSxDQUFDQTtRQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyQ0EsSUFBSUEsS0FBS0EsR0FBR0EsUUFBUUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDN0VBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLEtBQUtBLENBQUNBLEdBQUdBLEVBQUVBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQzNDQSxHQUFHQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNYQSxDQUFDQTtRQUNEQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUVoQkEsQ0FBQ0E7SUFDSE4sZ0JBQUNBO0FBQURBLENBM0VBLEFBMkVDQSxJQUFBO0FBM0VZLGlCQUFTLFlBMkVyQixDQUFBIiwiZmlsZSI6Im1uaXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vYWxsLnRzXCIgLz5cblxuaW1wb3J0IHtyZWFkRmlsZVN5bmN9IGZyb20gJ2ZzJztcbmltcG9ydCB7am9pbn0gZnJvbSAncGF0aCc7XG5cbmNvbnN0IGRhdGFQYXRoID0gJy4vZGlnaXRzJyxcbiAgICAgIGRpZ2l0c1BlckZpbGUgPSAzMDAwLFxuICAgICAgbnVtYmVyT2ZUcmFpbmluZ3MgPSA1MDAwMDtcblxuZXhwb3J0IGNsYXNzIERpZ2l0IHtcbiAgY29uc3RydWN0b3IgKFxuICAgIHB1YmxpYyBwaXhlbHM6IG51bWJlcltdLFxuICAgIHB1YmxpYyB2YWx1ZTogbnVtYmVyXG4gICkge1xuICAgIFxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBNbmlzdERhdGEge1xuICBwcml2YXRlIG1uaXN0VHJhaW5pbmc6IERpZ2l0W107XG4gIHByaXZhdGUgbW5pc3RWYWxpZGF0aW5nOiBEaWdpdFtdO1xuICBwcml2YXRlIG1uaXN0VGVzdGluZzogRGlnaXRbXTtcbiAgXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbnVtYmVyT2ZUcmFpbmluZ1RvUGFyc2U6IG51bWJlciA9IDIwLFxuICAgIHByaXZhdGUgbnVtYmVyT2ZUZXN0aW5nVG9QYXJzZTogbnVtYmVyID0gMVxuICApIHtcbiAgICBcbiAgICBsZXQgdHJhaW5pbmdzID0gW10sXG4gICAgICAgIHRlc3RpbmcsXG4gICAgICAgIGxhYmVscztcbiAgICAgICAgXG4gICAgZm9yIChsZXQgaSA9IDAgOyBpIDwgbnVtYmVyT2ZUcmFpbmluZ1RvUGFyc2U7IGkrKykge1xuICAgICAgdHJhaW5pbmdzLnB1c2goSlNPTi5wYXJzZShyZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsIGRhdGFQYXRoLCBgdHJhaW5pbmdfJHtpfS5qc29uYCkpLnRvU3RyaW5nKCkpKTtcbiAgICB9XG4gICAgdGVzdGluZyA9IEpTT04ucGFyc2UocmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCBkYXRhUGF0aCwgYHRlc3RpbmcuanNvbmApKS50b1N0cmluZygpKTtcbiAgICBsYWJlbHMgPSBKU09OLnBhcnNlKHJlYWRGaWxlU3luYyhqb2luKF9fZGlybmFtZSwgZGF0YVBhdGgsIGBtbmlzdF9sYWJlbHMuanNvbmApKS50b1N0cmluZygpKTtcbiAgICBcbiAgICB0aGlzLm1uaXN0VHJhaW5pbmcgPSB0aGlzLnBhcnNlU2V0cyh0cmFpbmluZ3MsIGxhYmVscyk7XG4gICAgdGhpcy5tbmlzdFRlc3RpbmcgPSB0aGlzLnBhcnNlT25lU2V0KHRlc3RpbmcsIGxhYmVscyk7XG4gICAgdGhpcy5tbmlzdFZhbGlkYXRpbmcgPSB0aGlzLm1uaXN0VHJhaW5pbmcuc3BsaWNlKG51bWJlck9mVHJhaW5pbmdzKTtcbiAgfVxuICBcbiAgcHVibGljIGdldE9uZVRyYWluaW5nICgpOiBEaWdpdCB7XG4gICAgbGV0IGluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5tbmlzdFRyYWluaW5nLmxlbmd0aCk7XG4gICAgcmV0dXJuIHRoaXMubW5pc3RUcmFpbmluZ1tpbmRleF07XG4gIH1cbiAgXG4gIHB1YmxpYyBnZXRPbmVWYWxpZGF0aW5nICgpOiBEaWdpdCB7XG4gICAgbGV0IGluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5tbmlzdFZhbGlkYXRpbmcubGVuZ3RoKTtcbiAgICByZXR1cm4gdGhpcy5tbmlzdFRlc3RpbmdbaW5kZXhdO1xuICB9XG4gIFxuICBwdWJsaWMgZ2V0T25lVGVzdGluZyAoKTogRGlnaXQge1xuICAgIGxldCBpbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMubW5pc3RUZXN0aW5nLmxlbmd0aCk7XG4gICAgcmV0dXJuIHRoaXMubW5pc3RUZXN0aW5nW2luZGV4XTtcbiAgfVxuICBcbiAgcHJpdmF0ZSBwYXJzZVNldHMgKHNldHM6IG51bWJlcltdW10sIGxhYmVsczogbnVtYmVyW10pOiBEaWdpdFtdIHtcbiAgICBsZXQgZGlnaXRzID0gW107XG4gICAgXG4gICAgZm9yIChsZXQgaSA9IDAgOyBpIDwgc2V0cy5sZW5ndGg7IGkrKykge1xuICAgICAgZGlnaXRzID0gZGlnaXRzLmNvbmNhdCh0aGlzLnBhcnNlT25lU2V0KHNldHNbaV0sIGxhYmVscywgaSkpO1xuICAgIH1cbiAgICByZXR1cm4gZGlnaXRzO1xuICAgIFxuICB9XG4gIFxuICBwcml2YXRlIHBhcnNlT25lU2V0IChzZXQ6IG51bWJlcltdLCBsYWJlbHM6IG51bWJlcltdLCBzZXRJbmRleDogbnVtYmVyID0gMjApOiBEaWdpdFtdIHtcbiAgICBsZXQgdG1wID0gW10sXG4gICAgICAgIGRpZ2l0cyA9IFtdO1xuICAgIFxuICAgIGlmIChzZXQubGVuZ3RoICUgKE1hdGgucG93KDI4LCAyKSkgIT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGxlbmd0aCBvZiB0aGUgdGVzdGluZyBwb3J0aW9uIHNob3VsZCBiZSBhIG11bHRpcGxlICR7MyAqIE1hdGgucG93KDI4LCAyKX1gKTtcbiAgICB9XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBzZXQubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgXG4gICAgICBpZiAodG1wLmxlbmd0aCA9PT0gKE1hdGgucG93KDI4LCAyKSkpIHtcbiAgICAgICAgbGV0IGluZGV4ID0gc2V0SW5kZXggKiAzMDAwICsgTWF0aC5mbG9vcihqIC8gKE1hdGgucG93KDI4LCAyKSAtIDEpKTtcbiAgICAgICAgZGlnaXRzLnB1c2gobmV3IERpZ2l0KHRtcCwgbGFiZWxzW2luZGV4XSkpO1xuICAgICAgICB0bXAgPSBbXTtcbiAgICAgIH1cbiAgICAgIHRtcC5wdXNoKHNldFtqXSk7XG4gICAgICBcbiAgICB9XG4gICAgaWYgKHRtcC5sZW5ndGggPT09IChNYXRoLnBvdygyOCwgMikpKSB7XG4gICAgICBsZXQgaW5kZXggPSBzZXRJbmRleCAqIDMwMDAgKyBNYXRoLmZsb29yKHNldC5sZW5ndGggLyAoTWF0aC5wb3coMjgsIDIpIC0gMSkpO1xuICAgICAgZGlnaXRzLnB1c2gobmV3IERpZ2l0KHRtcCwgbGFiZWxzW2luZGV4XSkpO1xuICAgICAgdG1wID0gW107XG4gICAgfVxuICAgIHJldHVybiBkaWdpdHM7XG4gICAgXG4gIH1cbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=